# Story 1.3: Carrier Management (CRUD)

**Status:** Draft

**Story:**
**As a** Manager,
**I want** to create, read, update, and delete carriers in the Back Office,
**so that** I can maintain an up-to-date list of our logistics partners and their cost data.

**Acceptance Criteria:**
1.  A "Carriers" section is accessible in the Back Office UI only to users with the "Manager" role.
2.  The manager can view a list of all existing carriers.
3.  The manager can add a new carrier with relevant details (e.g., company name, contact info, cost prices for services).
4.  The manager can edit and delete existing carriers.

**Tasks / Subtasks:**
- [x] Task 1 (AC: 1): Implement a middleware or gate to restrict access to the Carrier Management section to users with the "Manager" role.
- [x] Task 2 (AC: 2): Create a Vue component to display a list of carriers from the database.
- [ ] Task 3 (AC: 3): Create a form component (Vue) for adding a new carrier.
- [ ] Task 4 (AC: 3): Create a new controller and route in Laravel to handle the creation of a new carrier.
- [ ] Task 5 (AC: 4): Implement functionality to edit an existing carrier.
- [ ] Task 6 (AC: 4): Implement functionality to delete a carrier.
- [ ] Task 7 (AC: 3): Create a database seeder to populate a few sample carriers for testing.

**Dev Notes:**
*   **Data Model:** This story will use the `carriers` table. The schema is defined in `docs/architecture/database-schema.md`.
    *   **Carrier Fields:** The UI form and backend controller should handle the following fields: `company_name`, `contact_person`, `phone_number`, `email`, `cost_details`.
*   **File Paths:**
    *   **Controller:** `app/Http/Controllers/CarrierController.php`
    *   **Model:** `app/Models/Carrier.php`
    *   **Migration:** A new migration will be needed to create the `carriers` table as defined in the schema.
    *   **Frontend Index Page:** `resources/js/Pages/Carriers/Index.vue`
    *   **Frontend Form Component:** `resources/js/Components/Carriers/Form.vue`
*   **Backend:**
    *   The `CarrierController` will handle the CRUD operations. [Source: docs/architecture/backend-architecture.md]
    *   The `Carrier` model will be used. [Source: docs/architecture/data-models.md]
    *   Implement resource routes in `routes/web.php` for the CRUD operations. [Source: docs/architecture/backend-architecture.md]
*   **Frontend:**
    *   The `Index.vue` page will list the carriers. [Source: docs/architecture/frontend-architecture.md]
    *   The `Form.vue` component will be used for adding and editing carriers. [Source: docs/architecture/frontend-architecture.md]
*   **Security:**
    *   Use Laravel's authorization features (Gates or Policies) to implement the role-based access control for all carrier routes. [Source: docs/architecture/security-and-performance.md]
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the CRUD operations in the `CarrierController` and the authorization logic. [Source: docs/architecture/testing-strategy.md]
    *   Frontend tests (Vitest) should cover the display of carriers, form submission, and validation. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
*   **Agent Model Used:** James (Dev)
*   **Debug Log References:**
*   **Completion Notes:**
    *   Implemented role-based access control for carrier management using Laravel Gates.
    *   Created `add_role_to_users_table` migration and updated `AppServiceProvider`.
    *   Created `CarrierController` and resource routes with `can:manage-carriers` middleware.
    *   Created `create_carriers_table` migration and `Carrier` model.
    *   Created `resources/js/Pages/Carriers/Index.vue`.
*   **File List:**
    *   `database/migrations/2025_09_02_110104_add_role_to_users_table.php` (created/modified)
    *   `app/Providers/AppServiceProvider.php` (modified)
    *   `app/Http/Controllers/CarrierController.php` (created)
    *   `routes/web.php` (modified)
    *   `database/migrations/2025_09_02_110216_create_carriers_table.php` (created/modified)
    *   `app/Models/Carrier.php` (created/modified)
    *   `resources/js/Pages/Carriers/Index.vue` (created)
*   **Change Log:**
| Date       | Version | Description   | Author     |
| :---       | :---    | :---          | :---       |
| 2025-09-02 | 1.1     | Implemented initial access control and carrier listing setup. | James (Dev) |

**QA Results:**
*   **QA Agent:** Quinn
*   **Review Date:** 2025-09-02
*   **Findings:**
    *   **AC1 (Role-based access):** Covered. Automated tests (`tests/Feature/CarrierAccessTest.php`) verify that non-manager users cannot access carrier routes, while manager users can.
    *   **AC2 (View carrier list):** Covered. Automated tests (`tests/Feature/CarrierAccessTest.php`) verify that manager users can access the carrier index page and that the correct carrier data is passed to the Inertia view.
    *   **AC3 (Add new carrier):** Not implemented.
    *   **AC4 (Edit and delete carriers):** Not implemented.
*   **Decision:** PASS (for implemented parts)
*   **Confidence Score:** High (for implemented parts)
*   **Regression Test Plan:** Run `php artisan test` to verify backend functionality.
*   **Notes:** Automated tests have been added for the role-based access control and the carrier listing functionality. Further development and testing are required for AC3 and AC4.
