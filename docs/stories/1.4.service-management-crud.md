# Story 1.4: Service & Carrier Cost Management

**Status:** Draft

**Story:**
**As a** Manager,
**I want** to create and manage services, including their selling prices and the costs from various carriers,
**so that** we have a centralized and accurate price book for precise P&L calculations.

**Acceptance Criteria:**
1.  A "Services" section is accessible in the Back Office UI only to users with the "Manager" role.
2.  The manager can view a list of all existing services with their default selling prices.
3.  The manager can add a new service with a name, description, and default price.
4.  When adding or editing a service, the manager can also define the `cost` of that service for one or more specific carriers.
5.  The manager can edit and delete existing services.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Implement a middleware or gate to restrict access to the Service Management section to users with the "Manager" role.
- [ ] Task 2 (AC: 2): Create a Vue component to display a list of services from the database.
- [ ] Task 3 (AC: 3, 4): Enhance the service form component (Vue) to include a section for adding/editing carrier-specific costs.
- [ ] Task 4 (AC: 3, 4): Create/update the controller and routes in Laravel to handle the CRUD of services and their associated carrier costs.
- [ ] Task 5 (AC: 5): Implement functionality to edit an existing service and its costs.
- [ ] Task 6 (AC: 5): Implement functionality to delete a service.
- [ ] Task 7 (AC: 3, 4): Create a database seeder to populate a few sample services and their costs for testing.

**Dev Notes:**
*   **Data Model:** This story will use the `services` table and the new `carrier_service_costs` table.
    *   **Service Fields:** `name`, `description`, `price` (this will be the default selling price).
    *   **`carrier_service_costs` fields:** `carrier_id`, `service_id`, `cost`.
*   **File Paths:**
    *   **Controller:** `app/Http/Controllers/ServiceController.php`
    *   **Model:** `app/Models/Service.php`, `app/Models/CarrierServiceCost.php`
    *   **Migration:** A new migration will be needed for the `carrier_service_costs` table.
    *   **Frontend Index Page:** `resources/js/Pages/Services/Index.vue`
    *   **Frontend Form Component:** `resources/js/Components/Services/Form.vue`
*   **Backend:**
    *   The `ServiceController` will handle the CRUD operations for both services and their linked carrier costs.
*   **Frontend:**
    *   The `Form.vue` component will need a dynamic section (e.g., a repeater field) to allow managers to select a carrier from a dropdown and enter a cost for the service.
*   **Security:**
    *   Use Laravel's authorization features (Gates or Policies) to implement the role-based access control.
*   **Testing:**
    *   Backend tests must cover the CRUD operations for services and the logic for attaching/detaching carrier costs.
    *   Frontend tests should cover the dynamic form for managing carrier costs.

**Change Log:**
| Date       | Version | Description                               | Author     |
| :---       | :---    | :---                                      | :---       |
| 2025-09-01 | 2.0     | Added carrier cost management & role restrictions | Sarah (PO) |
| 2025-08-28 | 1.0     | Initial draft                             | Bob (SM)   |

**Dev Agent Record:**
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes:**
*   **File List:**
*   **Change Log:**

**QA Results:**
*   **QA Agent:**
*   **Review Date:**
*   **Findings:**
*   **Decision:**
*   **Confidence Score:**
*   **Regression Test Plan:**
*   **Notes:**
