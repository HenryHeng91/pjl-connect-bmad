# Story 3.2: Dynamic Driver Assignment Link Generation

**Status:** Draft

**Story:**
**As a** Carrier,
**I want** the system to provide a unique "magic link" for each job,
**so that** I can securely forward it to my assigned driver to begin the tracking process.

**Acceptance Criteria:**
1.  When the driver's Telegram username is submitted, the system generates a unique, single-use link.
2.  The Carrier Bot sends this link back to the carrier staff member who is managing the booking.
3.  The message includes an instruction for the carrier to forward this link to the assigned driver.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Implement the logic to generate a unique, single-use, and secure token associated with the shipment.
- [ ] Task 2 (AC: 1): Create a new route in `routes/web.php` that will be used for the magic link (e.g., `/track/{token}`).
- [ ] Task 3 (AC: 2): After the driver's Telegram username is submitted, send a message to the carrier with the generated magic link.
- [ ] Task 4 (AC: 3): The message should include clear instructions for the carrier to forward the link to the driver.

**Dev Notes:**
*   **External APIs:** This story requires integration with the Telegram Bot API to send messages. [Source: docs/architecture/external-apis.md]
*   **Core Workflow:** This story is part of the "Live Tracking & Customer Communication" workflow.
*   **Data Models:** This story will likely require a new table to store the magic tokens and their association with shipments, or a new field in the `shipments` table.
*   **Backend:**
    *   The token generation logic should be secure and produce a unique, hard-to-guess token for each shipment.
    *   Use the `TelegramNotificationService` to send the message to the carrier. [Source: docs/architecture/components.md]
*   **Security:**
    *   The magic link should be single-use to prevent unauthorized access.
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the token generation logic and the sending of the magic link to the carrier. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
**Agent Model Used:**
**Debug Log References:**
**Completion Notes List:**
**File List:**

**QA Results:**