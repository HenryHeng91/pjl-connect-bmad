# Story 2.3: Ops Manager Assignment Workflow

**Status:** Draft

**Story:**
**As an** Ops Manager,
**I want** to be notified of new bookings via Telegram and be able to assign them to my team with one click,
**so that** work is distributed quickly.

**Acceptance Criteria:**
1.  On "Pending Ops Review" status, a Telegram message is sent to the designated Ops Manager.
2.  The message suggests an assignee from the Ops team based on their current workload.
3.  The message has an "Assign" button that, when clicked, assigns the shipment to the suggested user.
4.  An alert is then sent to the assigned Ops member's Telegram account.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Create a notification that is sent to the Ops Manager when a shipment's status changes to "Pending Ops Review".
- [ ] Task 2 (AC: 2): Implement the logic to determine the suggested assignee based on workload (e.g., fewest currently assigned shipments).
- [ ] Task 3 (AC: 3): Implement the callback handler for the "Assign" button in the Telegram message to update the shipment record with the assigned user.
- [ ] Task 4 (AC: 4): Create a notification that is sent to the assigned Ops member after a shipment has been assigned to them.

**Dev Notes:**
*   **External APIs:** This story requires integration with the Telegram Bot API to send notifications and handle button callbacks. [Source: docs/architecture/external-apis.md]
*   **Core Workflow:** This story is a key part of the "New Booking Ingestion" workflow. [Source: docs/architecture/core-workflows.md]
*   **Data Models:** This story will update the `shipments` table with the assigned user. The schema is defined in `docs/architecture/database-schema.md`.
*   **Backend:**
    *   Create a `TelegramNotificationService` to handle the sending of all Telegram messages. [Source: docs/architecture/components.md]
    *   The logic for suggesting an assignee should be encapsulated in a service.
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the notification sending, the assignee suggestion logic, and the callback handler. It would be beneficial to mock the Telegram API. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes:**
*   **File List:**
*   **Change Log:**

**QA Results:**
*   **QA Agent:**
*   **Review Date:**
*   **Findings:**
*   **Decision:**
*   **Confidence Score:**
*   **Regression Test Plan:**
*   **Notes:**