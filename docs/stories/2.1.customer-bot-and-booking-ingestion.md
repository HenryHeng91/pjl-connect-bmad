# Story 2.1: Customer Bot & Booking Ingestion

**Status:** Draft

**Story:**
**As a** Customer,
**I want** to submit my booking document to a dedicated Telegram bot,
**so that** I can easily initiate a shipment request.

**Acceptance Criteria:**
1.  A Customer Telegram bot is created and connected to the Laravel backend.
2.  The bot can receive file submissions (PDF, JPG, Excel).
3.  When a file is received, the system creates a new shipment record with a "New" status, attaches the file, and logs the customer's Telegram user ID.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Create a new Telegram bot and configure the webhook to point to a new route in the Laravel application.
- [ ] Task 2 (AC: 1): **Implement webhook security to validate that incoming requests are genuinely from Telegram.**
- [ ] Task 3 (AC: 2): Implement the logic in the webhook controller to handle incoming file submissions from the Telegram bot.
- [ ] Task 4 (AC: 3): When a file is received, create a new `Booking` and a related `Shipment` record in the database.
- [ ] Task 5 (AC: 3): Store the received file and associate it with the created shipment record.
- [ ] Task 6 (AC: 3): Log the customer's Telegram user ID in the `bookings` table.

**Dev Notes:**
*   **File Paths:**
    *   **Webhook Controller:** `app/Http/Controllers/Webhooks/TelegramController.php`
*   **Security:**
    *   **Webhook Validation:** The webhook route must be protected. Validate incoming requests by checking for a secret token passed in the webhook URL, which should be stored securely in the `.env` file.
*   **External APIs:** This story requires integration with the Telegram Bot API. The developer will need to handle incoming webhooks from Telegram. [Source: docs/architecture/external-apis.md]
*   **Core Workflow:** This story is the entry point for the "New Booking Ingestion" workflow. [Source: docs/architecture/core-workflows.md]
*   **Data Models:** This story will use the `bookings` and `shipments` tables. The schemas are defined in `docs/architecture/database-schema.md`.
*   **Backend:**
    *   Create the `TelegramController.php` to handle the Telegram webhook. [Source: docs/architecture/backend-architecture.md]
    *   Implement the logic to create new `Booking` and `Shipment` records using the Eloquent ORM. [Source: docs/architecture/backend-architecture.md]
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the Telegram webhook controller, **webhook security validation**, file handling, and the creation of new records in the database. It would be beneficial to mock the Telegram API response. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
**Agent Model Used:**
**Debug Log References:**
**Completion Notes List:**
**File List:**

**QA Results:**