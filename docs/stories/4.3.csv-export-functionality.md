# Story 4.3: CSV Export Functionality

**Status:** Draft

**Story:**
**As a** Manager,
**I want** to export all shipment data to a CSV file,
**so that** I can perform custom analysis and reporting in external tools.

**Acceptance Criteria:**
1.  An "Export to CSV" button is available in the Back Office.
2.  The manager can select a date range for the export.
3.  The system generates and downloads a CSV file containing all relevant data for shipments within the selected range.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Add an "Export to CSV" button to the Manager Dashboard or a dedicated export page.
- [ ] Task 2 (AC: 2): Implement a UI for selecting a date range for the export.
- [ ] Task 3 (AC: 3): Create a backend endpoint that, when called, retrieves shipment data based on the selected date range.
- [ ] Task 4 (AC: 3): Implement logic to generate a CSV file from the retrieved data.
- [ ] Task 5 (AC: 3): Ensure the CSV file is downloaded by the user.

**Dev Notes:**
*   **Core Workflow:** This story is part of the "Manager Insights & Reporting" workflow.
*   **Data Models:** This story will read from the `shipments` table. The schema is defined in `docs/architecture/database-schema.md`.
*   **Backend:**
    *   Create a new controller and route to handle the CSV export request. [Source: docs/architecture/backend-architecture.md]
    *   Consider using a library for CSV generation to handle escaping and formatting correctly.
*   **Frontend:**
    *   The "Export to CSV" button and date range selector should be integrated into the Manager Dashboard or a new dedicated export view. [Source: docs/architecture/frontend-architecture.md]
*   **Security:**
    *   Ensure that only users with the "Manager" role can access this functionality. [Source: docs/architecture/security-and-performance.md]
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the data retrieval, CSV generation, and authorization logic. [Source: docs/architecture/testing-strategy.md]
    *   Frontend tests (Vitest) should cover the button functionality and date range selection. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes:**
*   **File List:**
*   **Change Log:**

**QA Results:**
*   **QA Agent:**
*   **Review Date:**
*   **Findings:**
*   **Decision:**
*   **Confidence Score:**
*   **Regression Test Plan:**
*   **Notes:**