# Story 2.2: OCR Processing & Data Extraction

**Status:** Draft

**Story:**
**As an** Ops Team Member,
**I want** the system to automatically read booking documents using OCR,
**so that** I don't have to enter the data manually.

**Acceptance Criteria:**
1.  When a shipment record has a "New" status, an OCR process is triggered.
2.  If the document matches a known template, key data is extracted and populated into the shipment record.
3.  The shipment status is updated to "Pending Ops Review".
4.  If the document format is unknown, the record remains largely blank but is still moved to "Pending Ops Review" status.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Create a scheduled job or an event listener that triggers the OCR process for new shipments.
- [ ] Task 2 (AC: 2): Implement a service that sends the booking document to AWS Textract for analysis.
- [ ] Task 3 (AC: 2): Implement the logic to parse the JSON response from AWS Textract and map the extracted data to the corresponding fields in the `shipments` table.
- [ ] Task 4 (AC: 3, 4): Update the shipment status to "Pending Ops Review" after the OCR process is complete, regardless of whether the document format was known or not.

**Dev Notes:**
*   **External APIs:** This story requires integration with AWS Textract. The developer will need to use the AWS SDK for PHP. [Source: docs/architecture/external-apis.md]
*   **Core Workflow:** This story is a key part of the "New Booking Ingestion" workflow. [Source: docs/architecture/core-workflows.md]
*   **Data Models:** This story will update the `shipments` table with the extracted data. The schema is defined in `docs/architecture/database-schema.md`.
*   **Backend:**
    *   Create a `BookingIngestionService` to encapsulate the logic for the OCR process. [Source: docs/architecture/components.md]
    *   The service should be designed to be extensible to support new document templates in the future.
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the `BookingIngestionService`. It would be beneficial to mock the AWS Textract API response to test the data mapping logic. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes:**
*   **File List:**
*   **Change Log:**

**QA Results:**
*   **QA Agent:**
*   **Review Date:**
*   **Findings:**
*   **Decision:**
*   **Confidence Score:**
*   **Regression Test Plan:**
*   **Notes:**