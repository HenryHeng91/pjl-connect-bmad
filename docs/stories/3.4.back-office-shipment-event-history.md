# Story 3.4: Back-Office Shipment Event History

**Status:** Draft

**Story:**
**As an** Ops Team Member,
**I want** to see a timeline of key tracking events within the booking detail view,
**so that** I can understand the shipment's journey and current status.

**Acceptance Criteria:**
1. The booking detail page in the Back Office displays a "Shipment History" section.
2. This section lists all significant events for the shipment in reverse chronological order (newest first).
3. Each event entry displays the event description and the timestamp of when it occurred.
4. If no tracking events have been recorded for the shipment, the section displays a "No shipment history available" message.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1, 2, 3): Create a new database migration for a `shipment_events` table (`shipment_id`, `event_description`, `created_at`).
- [ ] Task 2 (AC: 1, 2, 3): Create the `ShipmentEvent` Eloquent model.
- [ ] Task 3 (AC: 1, 2, 3): Create a new API endpoint (e.g., `/api/shipments/{id}/events`) to fetch all events for a specific shipment.
- [ ] Task 4 (AC: 1): Update the `BookingDetailView.vue` component to include a new `ShipmentHistory` component.
- [ ] Task 5 (AC: 2, 3, 4): Implement the `ShipmentHistory.vue` component to fetch and display the events from the API endpoint, handling the "no events" case.

**Dev Notes:**
*   **Core Workflow:** This story is part of the "Live Tracking & Customer Communication" workflow.
*   **Data Models:** This story requires a new `shipment_events` table. The proposed schema should be added to `docs/architecture/database-schema.md`.
    *   **`shipment_events` table schema:**
        *   `id` (Primary Key)
        *   `shipment_id` (Foreign Key to `shipments` table)
        *   `event_description` (String, e.g., "Shipment created", "Driver assigned", "In Transit", "Arrived at destination")
        *   `created_at` (Timestamp)
*   **Backend:**
    *   Create a new controller method and route for the shipment events API endpoint. The endpoint should return a JSON array of events. [Source: docs/architecture/backend-architecture.md]
*   **Frontend:**
    *   This story adds a new `ShipmentHistory` component to the booking detail view. The booking detail view itself is created in **Story 2.4: Back-office booking review and dispatch**.
    *   Create a new component `resources/js/Components/ShipmentHistory.vue`.
*   **Relevant Source Tree:**
    ```
    pjl-connect/
    ├── app/
    │   └── Http/
    │       └── Controllers/
    │           └── EventsController.php
    ├── resources/
    │   └── js/
    │       └── Components/
    │           └── ShipmentHistory.vue
    ```
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the new API endpoint, ensuring it returns the correct events for a shipment. [Source: docs/architecture/testing-strategy.md]
    *   Frontend tests (Vitest) should cover the `ShipmentHistory` component, including the correct display of events and the "no history" message. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date       | Version | Description                               | Author     |
| :---       | :---    | :---                                      | :---       |
| 2025-09-01 | 2.0     | Reworked story from live map to event history | Sarah (PO) |
| 2025-08-28 | 1.0     | Initial draft                             | Bob (SM)   |

**Dev Agent Record:**
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes:**
*   **File List:**
*   **Change Log:**

**QA Results:**
*   **QA Agent:**
*   **Review Date:**
*   **Findings:**
*   **Decision:**
*   **Confidence Score:**
*   **Regression Test Plan:**
*   **Notes:**