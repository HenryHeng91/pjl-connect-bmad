# Story 4.1: Data Aggregation for Reporting

**Status:** Draft

**Story:**
**As a** Manager,
**I want** the system to collect and process key data points from each shipment,
**so that** the data is ready for analysis on the dashboard and in exports.

**Acceptance Criteria:**
1.  A backend process is created to aggregate key metrics from completed shipments.
2.  This aggregated data is stored in a way that is optimized for quick retrieval.
3.  The aggregation process runs automatically as shipments are completed.

**Tasks / Subtasks:**
- [ ] Task 1 (AC: 1): Create a new service (e.g., `AnalyticsService`) responsible for aggregating key metrics from completed shipments.
- [ ] Task 2 (AC: 2): Design and implement a database table or a caching mechanism to store the aggregated data for quick retrieval.
- [ ] Task 3 (AC: 3): Implement a scheduled job or an event listener that triggers the aggregation process automatically when a shipment is completed.

**Dev Notes:**
*   **Core Workflow:** This story is part of the "Manager Insights & Reporting" workflow.
*   **Data Models:** This story will read from the `shipments` table and potentially write to a new aggregation table. The `shipments` table schema is defined in `docs/architecture/database-schema.md`.
*   **Backend:**
    *   The `AnalyticsService` should be designed to be efficient and scalable, especially as the number of shipments grows. [Source: docs/architecture/components.md]
    *   Consider using Laravel's caching mechanisms for frequently accessed aggregated data. [Source: docs/architecture/security-and-performance.md]
*   **Testing:**
    *   Backend tests (Pest/PHPUnit) should cover the aggregation logic and the data storage/retrieval. [Source: docs/architecture/testing-strategy.md]

**Change Log:**
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-28 | 1.0 | Initial draft | Bob (SM) |

**Dev Agent Record:**
**Agent Model Used:**
**Debug Log References:**
**Completion Notes List:**
**File List:**

**QA Results:**